<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ - ROCKET PC</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/users.css') }}">
</head>
<body>
    <div class="bg-animation"></div>

    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        {% include "dashboard/sidebar.html" %}

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <div class="header-title">
                    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                    <p class="header-subtitle">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Å–∏—Å—Ç–µ–º—ã</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="window.location.reload()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="btn" onclick="openModal('addUserModal')">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">–ê</div>
                        <div>
                            <div class="user-name" id="userName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                            <div class="user-role" id="userRole" style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">admin</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="stats-grid fade-in">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üë•</div>
                    </div>
                    <div class="stat-value">{{ users|length if users else 0 }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    <div class="stat-change">
                        <span>üìä</span> –í —Å–∏—Å—Ç–µ–º–µ
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üë§</div>
                    </div>
                    <div class="stat-value">
                        {% if users %}
                            {{ users|selectattr("role", "equalto", "admin")|list|length +
                               users|selectattr("role", "equalto", "director")|list|length }}
                        {% else %}0{% endif %}
                    </div>
                    <div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</div>
                    <div class="stat-change">
                        <span>üîê</span> –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üîß</div>
                    </div>
                    <div class="stat-value">
                        {% if users %}
                            {{ users|selectattr("role", "equalto", "master")|list|length }}
                        {% else %}0{% endif %}
                    </div>
                    <div class="stat-label">–ú–∞—Å—Ç–µ—Ä–æ–≤</div>
                    <div class="stat-change">
                        <span>‚ö°</span> –ê–∫—Ç–∏–≤–Ω—ã—Ö
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üìã</div>
                    </div>
                    <div class="stat-value">
                        {% if users %}
                            {{ users|selectattr("role", "equalto", "manager")|list|length }}
                        {% else %}0{% endif %}
                    </div>
                    <div class="stat-label">–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</div>
                    <div class="stat-change">
                        <span>üìà</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                    </div>
                </div>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filters-section fade-in">
                <form method="GET" action="/dashboard/users" class="filters-form">
                    <div class="filter-group">
                        <label>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" name="search" value="{{ request.query_params.get('search', '') }}"
                                   placeholder="–ò–º—è, email, —Ä–æ–ª—å..."
                                   onchange="this.form.submit()">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>–†–æ–ª—å</label>
                        <select name="role" onchange="this.form.submit()">
                            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                            <option value="admin" {{ 'selected' if request.query_params.get('role') == 'admin' }}>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            <option value="director" {{ 'selected' if request.query_params.get('role') == 'director' }}>–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
                            <option value="manager" {{ 'selected' if request.query_params.get('role') == 'manager' }}>–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="master" {{ 'selected' if request.query_params.get('role') == 'master' }}>–ú–∞—Å—Ç–µ—Ä</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>–°—Ç–∞—Ç—É—Å</label>
                        <select name="status" onchange="this.form.submit()">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="active" {{ 'selected' if request.query_params.get('status') == 'active' }}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                            <option value="inactive" {{ 'selected' if request.query_params.get('status') == 'inactive' }}>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                        <select name="sort" onchange="this.form.submit()">
                            <option value="name" {{ 'selected' if request.query_params.get('sort') == 'name' }}>–ü–æ –∏–º–µ–Ω–∏</option>
                            <option value="role" {{ 'selected' if request.query_params.get('sort') == 'role' }}>–ü–æ —Ä–æ–ª–∏</option>
                            <option value="created" {{ 'selected' if request.query_params.get('sort') == 'created' }}>–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è</option>
                            <option value="login" {{ 'selected' if request.query_params.get('sort') == 'login' }}>–ü–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤—Ö–æ–¥—É</option>
                        </select>
                    </div>
                </form>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-section fade-in">
                <div class="section-header">
                    <h3 class="section-title">–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div class="section-actions">
                        <span class="users-count">
                            {% if users %}{{ users|length }}{% else %}0{% endif %} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        </span>
                    </div>
                </div>

                {% if users %}
                <div class="users-grid">
                    {% for user in users %}
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-avatar-large">
                                {{ user.full_name[0].upper() if user.full_name else user.username[0].upper() }}
                            </div>
                            <div class="user-basic-info">
                                <h3 class="user-name">{{ user.full_name or user.username }}</h3>
                                <p class="user-username">@{{ user.username }}</p>
                                <div class="user-role-badge role-{{ user.role }}">
                                    {% if user.role == 'admin' %}
                                        üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                    {% elif user.role == 'director' %}
                                        üëî –î–∏—Ä–µ–∫—Ç–æ—Ä
                                    {% elif user.role == 'manager' %}
                                        üìã –ú–µ–Ω–µ–¥–∂–µ—Ä
                                    {% elif user.role == 'master' %}
                                        üîß –ú–∞—Å—Ç–µ—Ä
                                    {% else %}
                                        üë§ {{ user.role.title() }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="user-status">
                                {% if user.is_active %}
                                    <span class="status-badge status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                {% else %}
                                    <span class="status-badge status-inactive">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="user-details">
                            <div class="user-info-grid">
                                <div class="info-item">
                                    <span class="info-label">Email:</span>
                                    <span class="info-value">{{ user.email }}</span>
                                </div>
                                {% if user.phone %}
                                <div class="info-item">
                                    <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                                    <span class="info-value">{{ user.phone }}</span>
                                </div>
                                {% endif %}
                                <div class="info-item">
                                    <span class="info-label">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</span>
                                    <span class="info-value">
                                        {% if user.created_at %}
                                            {{ user.created_at.strftime('%d.%m.%Y') if user.created_at.strftime else user.created_at }}
                                        {% else %}
                                            –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                                    <span class="info-value">
                                        {% if user.last_login %}
                                            {{ user.last_login.strftime('%d.%m.%Y %H:%M') if user.last_login.strftime else user.last_login }}
                                        {% else %}
                                            –ù–∏–∫–æ–≥–¥–∞
                                        {% endif %}
                                    </span>
                                </div>
                            </div>

                            {% if user.role == 'master' and user.specialization %}
                            <div class="master-specialization">
                                <span class="spec-label">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</span>
                                <span class="spec-value">{{ user.specialization }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <div class="user-actions">
                            <button class="btn btn-outline btn-sm" onclick="openEditModal({{ user.id }}, '{{ user.username }}', '{{ user.email }}', '{{ user.full_name }}', '{{ user.role }}', {{ user.is_active|tojson }}, '{{ user.phone or '' }}')">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            {% if user.is_active %}
                            <form method="POST" action="/auth/users/{{ user.id }}/deactivate" style="display: inline;">
                                <button type="submit" class="btn btn-outline btn-sm btn-warning"
                                        onclick="return confirm('–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
                                    üö´ –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </form>
                            {% else %}
                            <form method="POST" action="/auth/users/{{ user.id }}/activate" style="display: inline;">
                                <button type="submit" class="btn btn-outline btn-sm btn-success">
                                    ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø–æ–∏—Å–∫–∞</p>
                    <button class="btn" onclick="openModal('addUserModal')">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="addUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="close" onclick="closeModal('addUserModal')">√ó</button>
            </div>

            <form method="POST" action="/auth/users">
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                        <input type="text" id="username" name="username" required
                               pattern="[a-zA-Z0-9_]+" title="–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è">
                    </div>
                    <div class="form-group">
                        <label for="full_name">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                        <input type="text" id="full_name" name="full_name" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="phone" name="phone" placeholder="+7 (999) 123-45-67">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="role">–†–æ–ª—å *</label>
                        <select id="role" name="role" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            <option value="admin">üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            <option value="director">üëî –î–∏—Ä–µ–∫—Ç–æ—Ä</option>
                            <option value="manager">üìã –ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="master">üîß –ú–∞—Å—Ç–µ—Ä</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="password">–ü–∞—Ä–æ–ª—å *</label>
                        <input type="password" id="password" name="password" required minlength="6">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('addUserModal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="editUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="close" onclick="closeModal('editUserModal')">√ó</button>
            </div>

            <form id="editUserForm" method="POST">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="edit_username" name="username" readonly
                               style="background: rgba(255,255,255,0.1); cursor: not-allowed;">
                    </div>
                    <div class="form-group">
                        <label for="edit_full_name">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                        <input type="text" id="edit_full_name" name="full_name" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_email">Email *</label>
                        <input type="email" id="edit_email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit_phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="edit_phone" name="phone">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_role">–†–æ–ª—å *</label>
                        <select id="edit_role" name="role" required>
                            <option value="admin">üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            <option value="director">üëî –î–∏—Ä–µ–∫—Ç–æ—Ä</option>
                            <option value="manager">üìã –ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="master">üîß –ú–∞—Å—Ç–µ—Ä</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_is_active">–°—Ç–∞—Ç—É—Å</label>
                        <select id="edit_is_active" name="is_active">
                            <option value="true">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="false">üö´ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å)</label>
                    <input type="password" id="edit_password" name="password" minlength="6">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('editUserModal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üë§ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
            await loadUserInfo();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        async function loadUserInfo() {
            try {
                const res = await fetch("/auth/profile", {
                    credentials: "include"
                });

                if (res.status === 401) {
                    window.location.href = "/auth/login";
                    return;
                }

                if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è");

                const user = await res.json();

                const userName = document.getElementById('userName');
                const userRole = document.getElementById('userRole');
                const userAvatar = document.getElementById('userAvatar');

                if (userName && user.full_name) {
                    userName.textContent = user.full_name;
                }

                if (userRole && user.role) {
                    const roleMap = {
                        'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        'director': '–î–∏—Ä–µ–∫—Ç–æ—Ä',
                        'manager': '–ú–µ–Ω–µ–¥–∂–µ—Ä',
                        'master': '–ú–∞—Å—Ç–µ—Ä'
                    };
                    userRole.textContent = roleMap[user.role] || user.role;
                }

                if (userAvatar && user.full_name) {
                    userAvatar.textContent = user.full_name.charAt(0).toUpperCase();
                }

                console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω:', user.full_name);

            } catch (err) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:", err);
                // –ù–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å —Ä–∞–±–æ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            }
        }
        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function openEditModal(id, username, email, fullName, role, isActive, phone) {
            document.getElementById('editUserForm').action = `/auth/users/${id}`;
            document.getElementById('edit_username').value = username;
            document.getElementById('edit_email').value = email;
            document.getElementById('edit_full_name').value = fullName;
            document.getElementById('edit_role').value = role;
            document.getElementById('edit_is_active').value = isActive ? 'true' : 'false';
            document.getElementById('edit_phone').value = phone || '';
            document.getElementById('edit_password').value = '';

            openModal('editUserModal');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.classList.toggle('active');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –Ω–∏—Ö
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal[style*="flex"]');
                openModals.forEach(modal => {
                    modal.style.display = 'none';
                });
                document.body.style.overflow = 'auto';
            }
        });
    </script>
</body>
</html>